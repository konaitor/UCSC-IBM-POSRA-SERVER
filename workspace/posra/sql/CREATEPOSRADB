USE POSRA;
SET SESSION sql_mode='NO_ENGINE_SUBSTITUTION';
CREATE TABLE Polymer
(
	polymerID INT AUTO_INCREMENT NOT NULL,
	name VARCHAR(255) NOT NULL,
	segmentID INT NOT NULL,
	CONSTRAINT Polymer_PK PRIMARY KEY(polymerID),
	CONSTRAINT Polymer_UC UNIQUE(name)
);

CREATE TABLE Segment
(
	segmentID INT AUTO_INCREMENT NOT NULL,
	bondCount INT NOT NULL,
	degree CHAR(255) NOT NULL,
	repeatUnitID INT,
	SMILESID INT,
	CONSTRAINT Segment_PK PRIMARY KEY(segmentID)
);

CREATE TABLE SMILES
(
	SMILESID INT AUTO_INCREMENT NOT NULL,
	SMILESString MEDIUMTEXT NOT NULL,
	CONSTRAINT SMILES_PK PRIMARY KEY(SMILESID)
);

CREATE TABLE RepeatUnit
(
	repeatUnitID INT AUTO_INCREMENT NOT NULL,
	segmentID INT NOT NULL,
	CONSTRAINT RepeatUnit_PK PRIMARY KEY(repeatUnitID)
);

CREATE TABLE ExternalID
(
	`value` VARCHAR(255) NOT NULL,
	polymerID INT NOT NULL,
	CONSTRAINT ExternalID_PK PRIMARY KEY(`value`)
);

CREATE TABLE SegmentAssociation
(
	polymerID INT NOT NULL,
	relationshipType CHAR(2) NOT NULL,
	segmentID1 INT NOT NULL,
	segmentID2 INT NOT NULL,
	CONSTRAINT SegmentAssociation_PK PRIMARY KEY(segmentID1, segmentID2, relationshipType, polymerID)
);

ALTER TABLE Polymer ADD CONSTRAINT Polymer_FK FOREIGN KEY (segmentID) REFERENCES Segment (segmentID) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE Segment ADD CONSTRAINT Segment_FK1 FOREIGN KEY (SMILESID) REFERENCES SMILES (SMILESID) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE Segment ADD CONSTRAINT Segment_FK2 FOREIGN KEY (repeatUnitID) REFERENCES RepeatUnit (repeatUnitID) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE RepeatUnit ADD CONSTRAINT RepeatUnit_FK FOREIGN KEY (segmentID) REFERENCES Segment (segmentID) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE ExternalID ADD CONSTRAINT ExternalID_FK FOREIGN KEY (polymerID) REFERENCES Polymer (polymerID) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE SegmentAssociation ADD CONSTRAINT SegmentAssociation_FK1 FOREIGN KEY (segmentID1) REFERENCES Segment (segmentID) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE SegmentAssociation ADD CONSTRAINT SegmentAssociation_FK2 FOREIGN KEY (segmentID2) REFERENCES Segment (segmentID) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE SegmentAssociation ADD CONSTRAINT SegmentAssociation_FK3 FOREIGN KEY (polymerID) REFERENCES Polymer (polymerID) ON DELETE RESTRICT ON UPDATE RESTRICT;
